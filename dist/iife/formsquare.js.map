{"version":3,"file":"formsquare.js","sources":["../../src/utils.js","../../src/elements.js","../../src/files.js","../../src/path.js","../../src/values.js","../../src/parser.js","../../src/formsquare.js"],"sourcesContent":["/* eslint no-use-before-define: [\"error\", { \"functions\": false }] */\n\nexport function all(p, arr) {\n  const len = arr.length;\n\n  for (let i = 0; i < len; i += 1) {\n    if (!p(arr[i])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport function allPass(ps) {\n  return (x) => all((p) => p(x), ps);\n}\n\nexport function any(p, arr) {\n  const len = arr.length;\n\n  for (let i = 0; i < len; i += 1) {\n    if (p(arr[i])) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexport function contains(el, arr) {\n  const len = arr.length;\n\n  for (let i = 0; i < len; i += 1) {\n    if (arr[i] === el) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexport function extendUniq(a, b) {\n  const len = b.length;\n\n  for (let i = 0; i < len; i += 1) {\n    if (!contains(b[i], a)) {\n      a.push(b[i]);\n    }\n  }\n\n  return a;\n}\n\nexport function filter(p, arr) {\n  const filtered = [];\n  const len = arr.length;\n\n  for (let i = 0; i < len; i += 1) {\n    if (p(arr[i])) {\n      filtered.push(arr[i]);\n    }\n  }\n\n  return filtered;\n}\n\nexport function flatMap(fn, arr) {\n  return reduce(\n    (acc, el) => {\n      const collection = fn(el);\n      const len = collection.length;\n\n      for (let i = 0; i < len; i += 1) {\n        acc.push(collection[i]);\n      }\n\n      return acc;\n    },\n    [],\n    arr,\n  );\n}\n\nexport function map(fn, arr) {\n  const mapped = [];\n  const len = arr.length;\n\n  for (let i = 0; i < len; i += 1) {\n    mapped.push(fn(arr[i]));\n  }\n\n  return mapped;\n}\n\nexport function reduce(fn, init, arr) {\n  let acc = init;\n  const len = arr.length;\n\n  for (let i = 0; i < len; i += 1) {\n    acc = fn(acc, arr[i]);\n  }\n\n  return acc;\n}\n\nexport function selectedValues(select) {\n  const options =\n    select.selectedOptions ||\n    filter((option) => option.selected, select.options);\n\n  return map((option) => option.value, options);\n}\n\nexport function startsWith(match, string) {\n  return string.slice(0, match.length) === match;\n}\n","import { contains, extendUniq, filter, flatMap } from \"./utils.js\";\n\n// eslint-disable-next-line import/prefer-default-export\nexport function formElements(form) {\n  if (form instanceof NodeList || Array.isArray(form)) {\n    return flatMap(formElements, form);\n  }\n\n  const { elements } = form;\n\n  if (\n    !form.id ||\n    (typeof window.HTMLFormControlsCollection === \"function\" &&\n      elements instanceof window.HTMLFormControlsCollection)\n  ) {\n    return elements;\n  }\n\n  // Polyfill for browsers that don't support html5 form attribute.\n  const outside = document.querySelectorAll(`[form=\"${form.id}\"]`);\n  const inside = filter(\n    (el) => contains(el.getAttribute(\"form\"), [\"\", null, form.id]),\n    elements,\n  );\n\n  return extendUniq(inside, outside);\n}\n","function splitDataURL(str) {\n  const protocolIndex = str.indexOf(\":\");\n  const mimeIndex = str.indexOf(\";\", protocolIndex);\n  const startIndex = str.indexOf(\",\", mimeIndex);\n\n  return {\n    type: str.slice(protocolIndex + 1, mimeIndex),\n    body: str.slice(startIndex + 1),\n  };\n}\n\n// eslint-disable-next-line import/prefer-default-export\nexport function readFile(file) {\n  if (!file) {\n    return Promise.resolve(null);\n  }\n\n  const reader = new FileReader();\n  const loaded = new Promise((resolve, reject) => {\n    reader.addEventListener(\"load\", resolve, false);\n    reader.addEventListener(\"error\", reject, false);\n    reader.addEventListener(\"abort\", reject, false);\n  });\n\n  reader.readAsDataURL(file);\n\n  return loaded.then((event) => {\n    // data:text/plain;base64,Zm9vCg\n    const { type, body } = splitDataURL(event.target.result);\n\n    return {\n      body,\n      type,\n      name: file.name,\n    };\n  });\n}\n","const DIGIT_RE = /^\\s*\\d+\\s*$/;\n\nexport function initialize(obj, path) {\n  if (obj === null) {\n    return typeof path[0] === \"number\" ? [] : Object.create(null);\n  }\n\n  return obj;\n}\n\nexport function getPath(name, path = []) {\n  if (name.length === 0) {\n    return path;\n  }\n\n  const open = name.indexOf(\"[\");\n  let close = name.indexOf(\"]\");\n\n  if (open <= 0 && close === -1) {\n    path.push(name);\n\n    return path;\n  }\n\n  while (close < open && close !== -1) {\n    close = name.slice(close).indexOf(\"]\");\n  }\n\n  if (close === -1) {\n    path.push(name);\n    return path;\n  }\n\n  if (open > 0) {\n    path.push(name.slice(0, open));\n    return getPath(name.slice(open), path);\n  }\n\n  const next = name.slice(open + 1, close);\n\n  if (next === \"\") {\n    path.push(-1);\n  } else if (next.match(DIGIT_RE)) {\n    path.push(Number.parseInt(next, 10));\n  } else {\n    path.push(next);\n  }\n\n  return getPath(name.slice(close + 1), path);\n}\n","// eslint-disable-next-line import/prefer-default-export\nexport function getWeek(value) {\n  // Get the date that starts this week.\n  if (!value.match(/^\\s*\\d+\\s*-W\\s*\\d+\\s*$/)) {\n    // Invalid week string.\n    return value;\n  }\n\n  let [year, week] = value.split(\"-W\");\n\n  year = parseInt(year, 10);\n  week = parseInt(week, 10);\n\n  if (week <= 0 || week > 53) {\n    // Invalid week string.\n    return value;\n  }\n\n  const naive = new Date(Date.UTC(year, 0, 1 + (week - 1) * 7));\n  const dayOfWeek = naive.getUTCDay();\n  const date = naive;\n\n  if (dayOfWeek <= 4) {\n    date.setUTCDate(naive.getUTCDate() - naive.getUTCDay() + 1);\n  } else {\n    date.setUTCDate(naive.getUTCDate() + 8 - naive.getUTCDay());\n  }\n\n  if (date.toString() === \"Invalid Date\") {\n    return value;\n  }\n\n  return date;\n}\n","import { readFile } from \"./files.js\";\nimport { getPath, initialize } from \"./path.js\";\nimport { getWeek } from \"./values.js\";\n\nimport {\n  any,\n  contains,\n  map,\n  reduce,\n  selectedValues,\n  startsWith,\n} from \"./utils.js\";\n\nfunction getValue(input, maps = []) {\n  if (input.type === \"select-multiple\") {\n    return selectedValues(input);\n  }\n\n  if (input.type === \"number\" || input.type === \"range\") {\n    return Number.parseFloat(input.value);\n  }\n\n  if (\n    contains(input.getAttribute(\"type\"), [\"date\", \"datetime-local\", \"month\"])\n  ) {\n    const date = new Date(input.value);\n\n    if (date.toString() === \"Invalid Date\") {\n      return input.value;\n    }\n\n    return date;\n  }\n\n  if (input.getAttribute(\"type\") === \"week\") {\n    return getWeek(input.value) || input.getAttribute(\"value\");\n  }\n\n  if (input.type === \"file\") {\n    if (input.multiple) {\n      if (input.files.length === 0) {\n        return Promise.resolve([]);\n      }\n\n      return Promise.all(map(readFile, input.files));\n    }\n\n    return readFile(input.files[0]);\n  }\n\n  let { value } = input;\n  maps.forEach((fn) => {\n    value = fn(value, input);\n  });\n\n  return value;\n}\n\nfunction fillSparse(node, attr) {\n  if (Array.isArray(node) && typeof attr === \"number\" && node.length < attr) {\n    for (let i = node.length; i < attr; i += 1) {\n      if (typeof node[i] === \"undefined\") {\n        Object.assign(node, { [i]: null });\n      }\n    }\n  }\n}\n\nfunction setLeaf(leaf, name, value, asObject) {\n  const attr = name === -1 ? leaf.length : name;\n\n  if (typeof leaf[attr] !== \"undefined\" && leaf[attr] !== null) {\n    if (!Array.isArray(leaf[attr])) {\n      Object.assign(leaf, { [attr]: [leaf[attr]] });\n    }\n\n    leaf[attr].push(asObject ? { \"\": value } : value);\n  } else {\n    fillSparse(leaf, attr);\n    Object.assign(leaf, { [attr]: asObject ? { \"\": value } : value });\n  }\n}\n\nfunction branch(path, node) {\n  if (path.length <= 1) {\n    return node;\n  }\n\n  const first = path[0];\n  const rest = path.slice(1);\n  const attr = first === -1 ? node.length : first;\n  const next = node[attr];\n\n  if (typeof next === \"undefined\") {\n    const nextBranch = typeof rest[0] === \"number\" ? [] : Object.create(null);\n\n    if (Array.isArray(node) && attr === -1) {\n      node.push(nextBranch);\n      return branch(rest, nextBranch);\n    }\n    fillSparse(node, attr);\n    Object.assign(node, { [attr]: nextBranch });\n  }\n\n  return branch(rest, node[attr]);\n}\n\nfunction hasArrayLeaf(path) {\n  return typeof path.slice(-1)[0] === \"number\";\n}\n\nfunction nonMember(obj, path) {\n  // This is a non-member of an array.\n  let node = obj;\n\n  if (node === null) {\n    // The array hasn't been initialized yet.\n    if (path.length === 0 || typeof path[0] === \"number\") {\n      return [];\n    }\n\n    // The array will go under a new branch.\n    node = Object.create(null);\n  }\n\n  const leaf = branch(path, node);\n  const attr = path.slice(-1)[0];\n\n  if (\n    path.length > 0 &&\n    typeof leaf[attr] === \"undefined\" &&\n    !hasArrayLeaf(path)\n  ) {\n    leaf[attr] = [];\n  }\n\n  return node;\n}\n\nexport default function parse(elements, maps) {\n  function setValue(obj, input) {\n    const { name, type } = input;\n    let { value } = input;\n    const path = getPath(name);\n\n    if (type === \"radio\" && !input.checked) {\n      // Do nothing.\n      return obj;\n    }\n    if (type === \"checkbox\" && input.getAttribute(\"value\") === null) {\n      value = input.checked;\n    } else if (type === \"checkbox\" && !input.checked) {\n      if (\n        hasArrayLeaf(path) ||\n        any((other) => other.name === name && other !== input, elements)\n      ) {\n        return nonMember(obj, path);\n      }\n      value = null;\n    } else {\n      value = getValue(input, maps);\n    }\n\n    if (path.length === 0) {\n      if (obj === null) {\n        // A singleton value\n        return value;\n      }\n\n      if (!Array.isArray(obj)) {\n        return [obj, value];\n      }\n\n      obj.push(value);\n\n      return obj;\n    }\n\n    const tree = initialize(obj, path, value);\n    const leaf = branch(path, tree);\n    const attr = path.slice(-1)[0];\n    const asObject =\n      typeof attr !== \"number\" &&\n      any(\n        (other) =>\n          startsWith(name, other.name) &&\n          other !== input &&\n          other.name.slice(name.length).match(/\\[[^\\]]\\]/),\n        elements,\n      );\n\n    setLeaf(leaf, attr, value, asObject);\n\n    return tree;\n  }\n\n  return reduce(setValue, null, elements);\n}\n","// @flow\n\nimport { formElements } from \"./elements.js\";\nimport parse from \"./parser.js\";\n\nimport { allPass, filter } from \"./utils.js\";\n\ninterface Formsquare {\n  filter((HTMLElement) => boolean): Formsquare;\n  parse(HTMLFormElement | Array<HTMLFormElement>): any;\n}\n\nfunction newFormsquare({\n  filters = [],\n  maps = [],\n}: {\n  filters?: Array<(HTMLElement) => boolean>,\n  maps?: Array<(Function) => any>,\n} = {}): Formsquare {\n  const formsquare: any = Object.create(null);\n\n  Object.defineProperty(formsquare, \"filter\", {\n    value(p: (HTMLElement) => boolean): Formsquare {\n      return newFormsquare({ filters: [...filters, p], maps });\n    },\n  });\n\n  Object.defineProperty(formsquare, \"map\", {\n    value(p: (Function) => any): Formsquare {\n      return newFormsquare({ maps: [...maps, p], filters });\n    },\n  });\n\n  Object.defineProperty(formsquare, \"parse\", {\n    value(form: HTMLFormElement | Array<HTMLFormElement>): any {\n      const elements = filter(allPass(filters), formElements(form));\n\n      return parse(elements, maps);\n    },\n  });\n\n  return formsquare;\n}\n\nexport default newFormsquare();\n"],"names":["all","p","arr","len","length","i","allPass","ps","x","any","contains","el","extendUniq","a","b","push","filter","filtered","flatMap","fn","reduce","acc","collection","map","mapped","init","selectedValues","select","options","selectedOptions","option","selected","value","startsWith","match","string","slice","formElements","form","NodeList","Array","isArray","elements","id","window","HTMLFormControlsCollection","outside","document","querySelectorAll","inside","getAttribute","splitDataURL","str","protocolIndex","indexOf","mimeIndex","startIndex","type","body","readFile","file","Promise","resolve","reader","FileReader","loaded","reject","addEventListener","readAsDataURL","then","event","target","result","name","DIGIT_RE","initialize","obj","path","Object","create","getPath","open","close","next","Number","parseInt","getWeek","split","year","week","naive","Date","UTC","dayOfWeek","getUTCDay","date","setUTCDate","getUTCDate","toString","getValue","input","maps","parseFloat","multiple","files","forEach","fillSparse","node","attr","assign","setLeaf","leaf","asObject","branch","first","rest","nextBranch","hasArrayLeaf","nonMember","parse","setValue","checked","other","tree","newFormsquare","filters","formsquare","defineProperty"],"mappings":"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"}